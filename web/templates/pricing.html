{% extends "base.html" %}
{% block title %}Pricing{% endblock %}

{% block content %}
<div class="pricing-page">
  <div class="section-label">// Plans</div>
  <h1 class="section-title" style="font-size: 2.5rem;">Choose Your Plan</h1>
  <p style="color: var(--text-secondary); max-width: 480px; margin: -24px auto 0;">
    Free 플랜으로 등급만 확인하고, Pro에서 상세 분석과 권장사항을 받아보세요.
  </p>

  <div class="pricing-grid">
    <!-- Free -->
    <div class="pricing-card">
      <div class="pricing-plan">Free</div>
      <div class="pricing-price">
        <span class="currency">&#8361;</span>0
        <span class="period">/ forever</span>
      </div>
      <div class="pricing-desc">코드의 현재 상태를 빠르게 파악</div>
      <ul class="pricing-features">
        <li><span class="check">&#x2713;</span> 월 3회 분석</li>
        <li><span class="check">&#x2713;</span> 4개 차원 등급 확인 (A~F)</li>
        <li><span class="check">&#x2713;</span> 종합 점수 / 등급</li>
        <li><span class="check">&#x2713;</span> Liebig's Law 취약 영역 표시</li>
        <li><span style="color: var(--text-muted);">&#x2717;</span> <span style="color: var(--text-muted);">상세 분석 리포트</span></li>
        <li><span style="color: var(--text-muted);">&#x2717;</span> <span style="color: var(--text-muted);">Critical Issues 목록</span></li>
        <li><span style="color: var(--text-muted);">&#x2717;</span> <span style="color: var(--text-muted);">맞춤 Recommendations</span></li>
      </ul>
      {% if user and user.plan == 'free' %}
        <button class="btn btn-ghost" style="width: 100%;" disabled>Current Plan</button>
      {% elif user and user.plan == 'pro' %}
        <button class="btn btn-ghost" style="width: 100%;" onclick="switchPlan('free')">Switch to Free</button>
      {% else %}
        <a href="{{ url_for('google_login') }}" class="btn btn-ghost" style="width: 100%;">Get Started</a>
      {% endif %}
    </div>

    <!-- Pro -->
    <div class="pricing-card featured">
      <div class="pricing-plan">Pro</div>
      <div class="pricing-price">
        <span class="currency">&#8361;</span>29,000
        <span class="period">/ month</span>
      </div>
      <div class="pricing-desc">코드 완성도를 끌어올리는 상세 분석</div>
      <ul class="pricing-features">
        <li><span class="check">&#x2713;</span> 무제한 분석</li>
        <li><span class="check">&#x2713;</span> 4개 차원 등급 + 세부 점수</li>
        <li><span class="check">&#x2713;</span> Sub-score별 상세 분석 (16개 항목)</li>
        <li><span class="check">&#x2713;</span> Critical Issues 전체 목록</li>
        <li><span class="check">&#x2713;</span> 코드 라인 수준 findings</li>
        <li><span class="check">&#x2713;</span> 맞춤 Recommendations</li>
        <li><span class="check">&#x2713;</span> JSON/PDF 리포트 다운로드</li>
        <li><span class="check">&#x2713;</span> GitHub repo URL 직접 분석</li>
      </ul>
      {% if user and user.plan == 'pro' %}
        <button class="btn btn-upgrade" style="width: 100%; opacity: 0.7;" disabled>Current Plan</button>
      {% elif user %}
        <button class="btn btn-upgrade" style="width: 100%;" onclick="switchPlan('pro')">Upgrade to Pro</button>
      {% else %}
        <a href="{{ url_for('google_login') }}" class="btn btn-upgrade" style="width: 100%;">Get Started</a>
      {% endif %}
    </div>

    <!-- Enterprise -->
    <div class="pricing-card">
      <div class="pricing-plan">Enterprise</div>
      <div class="pricing-price">
        Custom
      </div>
      <div class="pricing-desc">조직 전체의 코드 품질 관리</div>
      <ul class="pricing-features">
        <li><span class="check">&#x2713;</span> Pro 기능 전체 포함</li>
        <li><span class="check">&#x2713;</span> 팀 대시보드</li>
        <li><span class="check">&#x2713;</span> CI/CD 파이프라인 통합</li>
        <li><span class="check">&#x2713;</span> Custom 평가 기준 설정</li>
        <li><span class="check">&#x2713;</span> 트렌드 분석 (시계열)</li>
        <li><span class="check">&#x2713;</span> SSO / SAML 인증</li>
        <li><span class="check">&#x2713;</span> 전담 지원</li>
      </ul>
      <button class="btn btn-ghost" style="width: 100%;" onclick="alert('Coming soon! 문의: enterprise@airescue.dev')">Contact Sales</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function switchPlan(plan) {
  const url = plan === 'pro' ? '/api/upgrade-pro' : '/api/downgrade-free';
  try {
    const resp = await fetch(url, { method: 'POST' });
    const data = await resp.json();
    if (data.plan) {
      window.location.reload();
    }
  } catch (err) {
    alert('Failed: ' + err.message);
  }
}
</script>
{% endblock %}
